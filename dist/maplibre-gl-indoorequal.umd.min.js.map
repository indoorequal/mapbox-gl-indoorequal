{"version":3,"file":"maplibre-gl-indoorequal.umd.min.js","sources":["../node_modules/debounce/index.js","../node_modules/array-equal/index.js","../src/level_control.js","../src/layers.js","../src/image.js","../src/sprite.js","../src/index.js","../src/levels.js"],"sourcesContent":["function debounce(function_, wait = 100, options = {}) {\n\tif (typeof function_ !== 'function') {\n\t\tthrow new TypeError(`Expected the first parameter to be a function, got \\`${typeof function_}\\`.`);\n\t}\n\n\tif (wait < 0) {\n\t\tthrow new RangeError('`wait` must not be negative.');\n\t}\n\n\t// TODO: Deprecate the boolean parameter at some point.\n\tconst {immediate} = typeof options === 'boolean' ? {immediate: options} : options;\n\n\tlet storedContext;\n\tlet storedArguments;\n\tlet timeoutId;\n\tlet timestamp;\n\tlet result;\n\n\tfunction later() {\n\t\tconst last = Date.now() - timestamp;\n\n\t\tif (last < wait && last >= 0) {\n\t\t\ttimeoutId = setTimeout(later, wait - last);\n\t\t} else {\n\t\t\ttimeoutId = undefined;\n\n\t\t\tif (!immediate) {\n\t\t\t\tconst callContext = storedContext;\n\t\t\t\tconst callArguments = storedArguments;\n\t\t\t\tstoredContext = undefined;\n\t\t\t\tstoredArguments = undefined;\n\t\t\t\tresult = function_.apply(callContext, callArguments);\n\t\t\t}\n\t\t}\n\t}\n\n\tconst debounced = function (...arguments_) {\n\t\tif (storedContext && this !== storedContext) {\n\t\t\tthrow new Error('Debounced method called with different contexts.');\n\t\t}\n\n\t\tstoredContext = this; // eslint-disable-line unicorn/no-this-assignment\n\t\tstoredArguments = arguments_;\n\t\ttimestamp = Date.now();\n\n\t\tconst callNow = immediate && !timeoutId;\n\n\t\tif (!timeoutId) {\n\t\t\ttimeoutId = setTimeout(later, wait);\n\t\t}\n\n\t\tif (callNow) {\n\t\t\tconst callContext = storedContext;\n\t\t\tconst callArguments = storedArguments;\n\t\t\tstoredContext = undefined;\n\t\t\tstoredArguments = undefined;\n\t\t\tresult = function_.apply(callContext, callArguments);\n\t\t}\n\n\t\treturn result;\n\t};\n\n\tdebounced.clear = () => {\n\t\tif (!timeoutId) {\n\t\t\treturn;\n\t\t}\n\n\t\tclearTimeout(timeoutId);\n\t\ttimeoutId = undefined;\n\t};\n\n\tdebounced.flush = () => {\n\t\tif (!timeoutId) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst callContext = storedContext;\n\t\tconst callArguments = storedArguments;\n\t\tstoredContext = undefined;\n\t\tstoredArguments = undefined;\n\t\tresult = function_.apply(callContext, callArguments);\n\n\t\tclearTimeout(timeoutId);\n\t\ttimeoutId = undefined;\n\t};\n\n\treturn debounced;\n}\n\n// Adds compatibility for ES modules\nmodule.exports.debounce = debounce;\n\nmodule.exports = debounce;\n","/**\n * Compare arrays\n *\n * @param  {Array} arr1\n * @param  {Array} arr2\n * @return {Boolean} - Arrays are equals\n */\nmodule.exports = function equal(arr1, arr2) {\n  var length = arr1.length\n  if (arr1 === arr2) return true\n  if (length !== arr2.length) return false\n  for (var i = 0; i < length; i++)\n    if (arr1[i] !== arr2[i])\n      return false\n  return true\n}\n","export default class LevelControl {\n  constructor(indoorequal) {\n    this.indoorequal = indoorequal;\n    this._cbRefresh = () => this._refresh();\n    this.indoorequal.on('levelschange', this._cbRefresh);\n    this.indoorequal.on('levelchange', this._cbRefresh);\n\n    this.$el = document.createElement('div');\n    this.$el.classList.add('maplibregl-ctrl', 'maplibregl-ctrl-group', 'maplibregl-ctrl-indoorequal');\n    this._refresh();\n  }\n\n  destroy() {\n    this.$el.remove();\n    this.indoorequal.off('levelschange', this._cbRefresh);\n    this.indoorequal.off('levelchange', this._cbRefresh);\n  }\n\n  _refresh() {\n    this.$el.innerHTML = '';\n    this.indoorequal.levels.forEach((level) => {\n      const button = document.createElement('button');\n      const strong = document.createElement('strong');\n      strong.textContent = level;\n      button.appendChild(strong);\n      if (level == this.indoorequal.level) {\n        button.classList.add('maplibregl-ctrl-active');\n      }\n      button.addEventListener('click', () => {  this.indoorequal.setLevel(level); })\n      this.$el.appendChild(button);\n    });\n  }\n}\n","const commonPoi = {\n  \"type\": \"symbol\",\n  \"source-layer\": \"poi\",\n  \"layout\": {\n    \"icon-image\": [\n      \"coalesce\",\n      [\n        \"image\",\n        [\n          \"concat\",\n          [\n            \"literal\",\n            \"indoorequal-\"\n          ],\n          [\n            \"get\",\n            \"subclass\"\n          ]\n        ],\n      ],\n      [\n        \"image\",\n        [\n          \"concat\",\n          [\n            \"literal\",\n            \"indoorequal-\"\n          ],\n          [\n            \"get\",\n            \"class\"\n          ]\n        ]\n      ]\n    ],\n    \"text-anchor\": \"top\",\n    \"text-field\": [\n      \"concat\",\n      [\"get\", \"name:latin\"],\n      \"\\n\",\n      [\"get\", \"name:nonlatin\"],\n    ],\n    \"text-max-width\": 9,\n    \"text-offset\": [\n      0,\n      0.6\n    ],\n    \"text-padding\": 2,\n    \"text-size\": 12\n  },\n  \"paint\": {\n    \"text-color\": \"#666\",\n    \"text-halo-blur\": 0.5,\n    \"text-halo-color\": \"#ffffff\",\n    \"text-halo-width\": 1\n  }\n};\n\nconst rank2Class = [\"waste_basket\", \"information\", \"vending_machine\", \"bench\", \"photo_booth\", \"ticket_validator\"];\n\nexport const layers = [\n  {\n    id: \"indoor-polygon\",\n    type: \"fill\",\n    \"source-layer\": \"area\",\n    filter: [\n      \"all\",\n      [\n        \"==\",\n        \"$type\",\n        \"Polygon\"\n      ],\n      [\n        \"!=\",\n        \"class\",\n        \"level\"\n      ]\n    ],\n    paint: {\n      \"fill-color\": [\n        \"case\",\n        // if private\n        [\"all\", [\"has\", \"access\"], [\"in\", [\"get\", \"access\"], [\"literal\", [\"no\", \"private\"]]]],\n        \"#F2F1F0\",\n        // if POI\n        [\"any\",\n         [\"all\", [\"==\", [\"get\", \"is_poi\"], true], [\"!=\", [\"get\", \"class\"], \"corridor\"]],\n         [\n           \"in\",\n           [\"get\", \"subclass\"],\n           [\"literal\", [\"class\", \"laboratory\", \"office\", \"auditorium\", \"amphitheatre\", \"reception\"]]]\n        ],\n        \"#D4EDFF\",\n        // if is a room\n        [\"==\", [\"get\", \"class\"], \"room\"],\n        \"#fefee2\",\n        // default\n        \"#fdfcfa\"\n      ]\n    }\n  },\n  {\n    id: \"indoor-area\",\n    \"type\": \"line\",\n    \"source-layer\": \"area\",\n    \"filter\": [\n      \"all\",\n      [\n        \"in\",\n        \"class\",\n        \"area\",\n        \"corridor\",\n        \"platform\"\n      ]\n    ],\n    \"paint\": {\n      \"line-color\": \"#bfbfbf\",\n      \"line-width\": 1\n    }\n  },\n  {\n    id: \"indoor-column\",\n    \"type\": \"fill\",\n    \"source-layer\": \"area\",\n    \"filter\": [\n      \"all\",\n      [\n        \"==\",\n        \"class\",\n        \"column\"\n      ]\n    ],\n    \"paint\": {\n      \"fill-color\": \"#bfbfbf\"\n    }\n  },\n  {\n    id: \"indoor-lines\",\n    \"type\": \"line\",\n    \"source-layer\": \"area\",\n    \"filter\": [\n      \"all\",\n      [\n        \"in\",\n        \"class\",\n        \"room\",\n        \"wall\"\n      ]\n    ],\n    \"paint\": {\n      \"line-color\": \"gray\",\n      \"line-width\": 2\n    }\n  },\n  {\n    id: \"indoor-transportation\",\n    \"type\": \"line\",\n    \"source-layer\": \"transportation\",\n    \"filter\": [\n      \"all\"\n    ],\n    \"paint\": {\n      \"line-color\": \"gray\",\n      \"line-dasharray\": [\n        0.4,\n        0.75\n      ],\n      \"line-width\": {\n        \"base\": 1.4,\n        \"stops\": [\n          [\n            17,\n            2\n          ],\n          [\n            20,\n            10\n          ]\n        ]\n      }\n    }\n  },\n  {\n    id: \"indoor-transportation-poi\",\n    \"type\": \"symbol\",\n    \"source-layer\": \"transportation\",\n    \"filter\": [\n      \"all\",\n      [\n        \"in\",\n        \"$type\",\n        \"Point\",\n        \"LineString\"\n      ],\n      [\n        \"in\",\n        \"class\",\n        \"steps\",\n        \"elevator\",\n        \"escalator\"\n      ]\n    ],\n    \"layout\": {\n      \"icon-image\": [\n        \"case\",\n        [\n          \"has\",\n          \"conveying\"\n        ],\n        \"indoorequal-escalator\",\n        [\n          \"concat\",\n          [\n            \"literal\",\n            \"indoorequal-\"\n          ],\n          [\n            \"get\",\n            \"class\"\n          ]\n        ]\n      ],\n      \"symbol-placement\": \"line-center\",\n      \"icon-rotation-alignment\": \"viewport\"\n    }\n  },\n  {\n    id: \"indoor-poi-rank1\",\n    ...commonPoi,\n    \"filter\": [\n      \"all\",\n      [\n        \"==\",\n        \"$type\",\n        \"Point\"\n      ],\n      [\n        \"!in\",\n        \"class\",\n        ...rank2Class\n      ]\n    ]\n  },\n  {\n    id: \"indoor-poi-rank2\",\n    ...commonPoi,\n    minzoom: 19,\n    \"filter\": [\n      \"all\",\n      [\n        \"==\",\n        \"$type\",\n        \"Point\"\n      ],\n      [\n        \"in\",\n        \"class\",\n        ...rank2Class\n      ]\n    ]\n  },\n  {\n    id: \"indoor-heat\",\n    \"type\": \"heatmap\",\n    \"source-layer\": \"heat\",\n    \"filter\": [ \"all\" ],\n    \"paint\": {\n      \"heatmap-color\": [\"interpolate\", [\"linear\"], [\"heatmap-density\"],\n        0, \"rgba(102, 103, 173, 0)\",\n        0.1, \"rgba(102, 103, 173, 0.2)\",\n        1, \"rgba(102, 103, 173, 0.7)\"\n      ],\n      \"heatmap-radius\": [\n        \"interpolate\", [\"linear\"], [\"zoom\"],\n        0, 3,\n        13, 20,\n        17, 40\n      ],\n      \"heatmap-intensity\": 1,\n      \"heatmap-opacity\": [\n        \"interpolate\", [\"linear\"], [\"zoom\"],\n        16, 1,\n        17.1, 0\n      ]\n    }\n  },\n  {\n    id: \"indoor-name\",\n    \"type\": \"symbol\",\n    \"source-layer\": \"area_name\",\n    \"filter\": [\n      \"all\"\n    ],\n    \"layout\": {\n      \"text-field\": [\n        \"concat\",\n        [\"coalesce\",\n         [\"get\", \"name:latin\"],\n         [\"get\", \"ref\"],\n        ],\n        \"\\n\",\n        [\"get\", \"name:nonlatin\"],\n      ],\n      \"text-max-width\": 5,\n      \"text-size\": 14\n    },\n    \"paint\": {\n      \"text-color\": \"#666\",\n      \"text-halo-color\": \"#ffffff\",\n      \"text-halo-width\": 1\n    }\n  }\n];\n","function createImage(image, {width, height}, channels, data) {\n    if (!data) {\n        data = new Uint8Array(width * height * channels);\n    } else if (data instanceof Uint8ClampedArray) {\n        data = new Uint8Array(data.buffer);\n    } else if (data.length !== width * height * channels) {\n        throw new RangeError('mismatched image size');\n    }\n    image.width = width;\n    image.height = height;\n    image.data = data;\n    return image;\n}\n\nfunction resizeImage(image, {width, height}, channels) {\n    if (width === image.width && height === image.height) {\n        return;\n    }\n\n    const newImage = createImage({}, {width, height}, channels);\n\n    copyImage(image, newImage, {x: 0, y: 0}, {x: 0, y: 0}, {\n        width: Math.min(image.width, width),\n        height: Math.min(image.height, height)\n    }, channels);\n\n    image.width = width;\n    image.height = height;\n    image.data = newImage.data;\n}\n\nfunction copyImage(srcImg, dstImg, srcPt, dstPt, size, channels) {\n    if (size.width === 0 || size.height === 0) {\n        return dstImg;\n    }\n\n    if (size.width > srcImg.width ||\n        size.height > srcImg.height ||\n        srcPt.x > srcImg.width - size.width ||\n        srcPt.y > srcImg.height - size.height) {\n        throw new RangeError('out of range source coordinates for image copy');\n    }\n\n    if (size.width > dstImg.width ||\n        size.height > dstImg.height ||\n        dstPt.x > dstImg.width - size.width ||\n        dstPt.y > dstImg.height - size.height) {\n        throw new RangeError('out of range destination coordinates for image copy');\n    }\n\n    const srcData = srcImg.data;\n    const dstData = dstImg.data;\n\n    for (let y = 0; y < size.height; y++) {\n        const srcOffset = ((srcPt.y + y) * srcImg.width + srcPt.x) * channels;\n        const dstOffset = ((dstPt.y + y) * dstImg.width + dstPt.x) * channels;\n        for (let i = 0; i < size.width * channels; i++) {\n            dstData[dstOffset + i] = srcData[srcOffset + i];\n        }\n    }\n    return dstImg;\n}\n\n// Not premultiplied, because ImageData is not premultiplied.\n// UNPACK_PREMULTIPLY_ALPHA_WEBGL must be used when uploading to a texture.\nexport class RGBAImage {\n    constructor(size, data) {\n        createImage(this, size, 4, data);\n    }\n\n    resize(size) {\n        resizeImage(this, size, 4);\n    }\n\n    replace(data, copy) {\n        if (copy) {\n            this.data.set(data);\n        } else if (data instanceof Uint8ClampedArray) {\n            this.data = new Uint8Array(data.buffer);\n        } else {\n            this.data = data;\n        }\n    }\n\n    clone() {\n        return new RGBAImage({width: this.width, height: this.height}, new Uint8Array(this.data));\n    }\n\n    static copy(srcImg, dstImg, srcPt, dstPt, size) {\n        copyImage(srcImg, dstImg, srcPt, dstPt, size, 4);\n    }\n}\n","import {RGBAImage} from './image';\n\nfunction getImageData(img, padding) {\n  const canvas = window.document.createElement('canvas');\n  const context = canvas.getContext('2d');\n  if (!context) {\n    throw new Error('failed to create canvas 2d context');\n  }\n  canvas.width = img.width;\n  canvas.height = img.height;\n  context.drawImage(img, 0, 0, img.width, img.height);\n  return context.getImageData(0, 0, img.width, img.height);\n}\n\nexport default function(baseUrl) {\n  const format = window.devicePixelRatio > 1 ? '@2x' : '';\n  let json, image;\n\n  const jsonRequest = fetch(`${baseUrl}${format}.json`)\n        .then(r => r.json())\n        .then(r => json = r)\n\n  const imageRequest = fetch(`${baseUrl}${format}.png`)\n        .then(r => r.blob())\n        .then(r => {\n          image = new Image();\n          image.src = URL.createObjectURL(r);\n          return new Promise((resolve, reject) => {\n            image.onload = () => resolve();\n            image.onerror = () => reject();\n          });\n        });\n\n  return Promise.all([jsonRequest, imageRequest])\n    .then(() => {\n      const imageData = getImageData(image);\n      const result = {};\n\n      for (const id in json) {\n        const {width, height, x, y, sdf, pixelRatio, stretchX, stretchY, content} = json[id];\n        const data = new RGBAImage({width, height});\n        RGBAImage.copy(imageData, data, {x, y}, {x: 0, y: 0}, {width, height});\n        result[id] = {data, pixelRatio, sdf, stretchX, stretchY, content};\n      }\n      return result;\n    });\n}\n","import debounce from 'debounce';\nimport arrayEqual from 'array-equal';\nimport findAllLevels from './levels';\nimport LevelControl from './level_control';\nimport { layers } from './layers';\nimport loadSprite from './sprite';\n\nclass GeoJSONSource {\n  constructor(map, options = {}) {\n    const defaultOpts = { layers, geojson: {} };\n    const opts = { ...defaultOpts, ...options };\n    this.map = map;\n    this.geojson = opts.geojson;\n    this.layers = opts.layers;\n    this.baseSourceId = 'indoorequal';\n    this.sourceId = `${this.baseSourceId}_area`;\n  }\n\n  addSource() {\n    Object.keys(this.geojson).forEach((layerName) => {\n      this.map.addSource(`${this.baseSourceId}_${layerName}`, {\n        type: 'geojson',\n        data: this.geojson[layerName]\n      });\n    });\n  }\n\n  addLayers() {\n    const sourceLayers = Object.keys(this.geojson);\n    const layers = this.layers;\n    this.layers = layers.filter((layer) => {\n      return sourceLayers.includes(layer['source-layer']);\n    });\n    this.layers.forEach((layer) => {\n      this.map.addLayer({\n        source: `${this.baseSourceId}_${layer['source-layer']}`,\n        ...layer,\n        'source-layer': ''\n      });\n    });\n  }\n\n  remove() {\n    this.layers.forEach((layer) => {\n      this.map.removeLayer(layer.id);\n    });\n    Object.keys(this.geojson).forEach((layerName) => {\n      this.map.removeSource(`${this.baseSourceId}_${layerName}`);\n    });\n  }\n}\n\nclass VectorTileSource {\n  constructor(map, options = {}) {\n    const defaultOpts = { url: 'https://tiles.indoorequal.org/', layers };\n    const opts = { ...defaultOpts, ...options };\n    if (opts.url === defaultOpts.url && !opts.apiKey) {\n      throw 'You must register your apiKey at https://indoorequal.com before and set it as apiKey param.';\n    }\n    this.map = map;\n    this.url = opts.url;\n    this.apiKey = opts.apiKey;\n    this.layers = opts.layers;\n    this.sourceId = 'indoorequal';\n  }\n\n  addSource() {\n    const queryParams = this.apiKey ? `?key=${this.apiKey}` : '';\n    this.map.addSource(this.sourceId, {\n      type: 'vector',\n      url: `${this.url}${queryParams}`\n    });\n  }\n\n  addLayers() {\n    this.layers.forEach((layer) => {\n      this.map.addLayer({\n        source: this.sourceId,\n        ...layer\n      });\n    });\n  }\n\n  remove() {\n    this.layers.forEach((layer) => {\n      this.map.removeLayer(layer.id);\n    });\n    this.map.removeSource(this.sourceId);\n  }\n}\n\n/**\n * Load the indoor= source and layers in your map.\n * @param {object} map the maplibre-gl instance of the map\n * @param {object} options\n * @param {string} [options.url] Override the default tiles URL (https://tiles.indoorequal.org/).\n * @param {object} [options.geojson] GeoJSON data with with key as layer name and value with geojson features\n * @param {string} [options.apiKey] The API key if you use the default tile URL (get your free key at [indoorequal.com](https://indoorequal.com)).\n * @param {array} [options.layers] The layers to be used to style indoor= tiles. Take a look a the [layers.js file](https://github.com/indoorequal/maplibre-gl-indoorequal/blob/master/src/layers.js) file and the [vector schema](https://indoorequal.com/schema)\n * @param {boolean} [options.heatmap] Should the heatmap layer be visible at start (true : visible, false : hidden). Defaults to true/visible.\n * @property {string} level The current level displayed\n * @property {array} levels  The levels that can be displayed in the current view\n * @fires IndoorEqual#levelschange\n * @fires IndoorEqual#levelchange\n * @return {IndoorEqual} `this`\n */\nexport default class IndoorEqual {\n  constructor(map, options = {}) {\n    const SourceKlass = options.geojson ? GeoJSONSource : VectorTileSource;\n    const defaultOpts = { heatmap: true };\n    const opts = { ...defaultOpts, ...options };\n    this.source = new SourceKlass(map, options);\n    this.map = map;\n    this.levels = [];\n    this.level = '0';\n    this.events = {};\n\n    if (this.map.isStyleLoaded()) {\n      this._init();\n      this.setHeatmapVisible(opts.heatmap);\n    } else {\n      this.map.once('load', () => {\n        this._init();\n        this.setHeatmapVisible(opts.heatmap);\n      });\n    }\n  }\n\n  /**\n   * Remove any layers, source and listeners and controls\n   */\n  remove(fromRemoveEvent) {\n    if (!fromRemoveEvent) {\n      this.source.remove();\n    }\n    this._updateLevelsDebounce.clear();\n    this.map.off('load', this._updateLevelsDebounce);\n    this.map.off('data', this._updateLevelsDebounce);\n    this.map.off('move', this._updateLevelsDebounce);\n    if (this._control) {\n      this.onRemove();\n    }\n  }\n\n  /**\n   * Add an event listener\n   * @param {string} name the name of the event\n   * @param {function} fn the function to be called when the event is emitted\n   */\n  on(name, fn) {\n    if (!this.events[name]) {\n      this.events[name] = [];\n    }\n    this.events[name].push(fn);\n  }\n\n  /**\n   * Remove an event listener.\n   * @param {string} name the name of the event\n   * @param {function} fn the same function when on() was called\n   */\n  off(name, fn) {\n    if (!this.events[name]) {\n      this.events[name] = [];\n    }\n    this.events[name] = this.events[name].filter(cb => cb !== fn);\n  }\n\n  /**\n   * Add the level control to the map\n   * Used when adding the control via the map instance: map.addControl(indoorEqual)\n   */\n  onAdd() {\n    this._control = new LevelControl(this);\n    return this._control.$el;\n  }\n\n  /**\n   * Remove the level control\n   * Used when removing the control via the map instance: map.removeControl(indoorEqual)\n   */\n  onRemove() {\n    this._control.destroy();\n    this._control = null;\n  }\n\n  /**\n   * Set the displayed level.\n   * @param {string} level the level to be displayed\n   * @fires IndoorEqual#levelchange\n   */\n  setLevel(level) {\n    this.level = level;\n    this._updateFilters();\n    this._emitLevelChange();\n  }\n\n  /**\n   * Set the displayed level.\n   * @deprecated Use setLevel instead\n   * @param {string} level the level to be displayed\n   * @fires IndoorEqual#levelchange\n   */\n  updateLevel(level) {\n    console.log('The updateLevel method is deprecated. Please use setLevel instead.');\n    this.setLevel(level);\n  }\n\n  /**\n   * Load a sprite and add all images to the map\n   * @param {string} baseUrl the baseUrl where to load the sprite\n   * @param {object} options\n   * @param {boolean} [options.update] Update existing image (default false)\n   * @return {Promise} It resolves an hash of images.\n   */\n  loadSprite(baseUrl, options = {}) {\n    const opts = { update: false, ...options };\n    return loadSprite(baseUrl)\n      .then((sprite) => {\n        for (const id in sprite) {\n          const { data, ...options } = sprite[id];\n          if (!this.map.hasImage(id)) {\n            this.map.addImage(id, data, options);\n          } else if (opts.update) {\n            this.map.updateImage(id, data);\n          }\n        }\n        return sprite;\n      });\n  }\n\n  /**\n   * Change the heatmap layer visibility\n   * @param {boolean} visible True to make it visible, false to hide it\n   */\n  setHeatmapVisible(visible) {\n    if (this.map.getLayer('indoor-heat')) {\n      this.map.setLayoutProperty('indoor-heat', 'visibility', visible ? 'visible' : 'none');\n    }\n  }\n\n  _init() {\n    this.source.addSource();\n    this.source.addLayers();\n    this._updateFilters();\n    this._updateLevelsDebounce = debounce(this._updateLevels.bind(this), 1000);\n\n    this.map.on('load', this._updateLevelsDebounce);\n    this.map.on('data', this._updateLevelsDebounce);\n    this.map.on('move', this._updateLevelsDebounce);\n    this.map.on('remove', () => {\n      this.remove(true);\n    });\n  }\n\n  _updateFilters() {\n    this.source.layers\n    .filter(layer => layer.type !== 'heatmap')\n    .forEach((layer) => {\n      this.map.setFilter(layer.id, [ ...layer.filter || ['all'], ['==', 'level', this.level]]);\n    });\n  }\n\n  _refreshAfterLevelsUpdate() {\n    if (!this.levels.includes(this.level)) {\n      this.setLevel('0');\n    }\n  }\n\n  _updateLevels() {\n    if (this.map.isSourceLoaded(this.source.sourceId)) {\n      const features = this.map.querySourceFeatures(this.source.sourceId, { sourceLayer: 'area' });\n      const levels = findAllLevels(features);\n      if (!arrayEqual(levels, this.levels)) {\n        this.levels = levels;\n        this._emitLevelsChange();\n        this._refreshAfterLevelsUpdate();\n      }\n    }\n  }\n\n  _emitLevelsChange() {\n    this._emitEvent('levelschange', this.levels);\n  }\n\n  _emitLevelChange() {\n    this._emitEvent('levelchange', this.level);\n  }\n\n  _emitEvent(eventName, ...args) {\n    (this.events[eventName] || []).forEach(fn => fn(...args));\n  }\n}\n\n/**\n * Emitted when the list of available levels has been updated\n *\n * @event IndoorEqual#levelschange\n * @type {array}\n */\n\n/**\n * Emitted when the current level has been updated\n *\n * @event IndoorEqual#levelchange\n * @type {string} always emitted when the level displayed has changed\n */\n","export default function findAllLevels(features) {\n  const levels = [];\n  for (let i = 0; i < features.length; i++) {\n    const feature = features[i];\n    if (feature.properties.class === 'level') {\n      continue;\n    }\n    const level = feature.properties.level;\n    if (!levels.includes(level)) {\n      levels.push(level);\n    }\n  }\n  return levels.sort((a, b) => a - b).reverse();\n}\n"],"names":["debounce","function_","wait","options","TypeError","RangeError","immediate","storedContext","storedArguments","timeoutId","timestamp","result","later","last","Date","now","setTimeout","undefined","callContext","callArguments","apply","debounced","arguments_","this","Error","callNow","clear","clearTimeout","flush","debounceModule","exports","arr1","arr2","length","i","LevelControl","_createClass","indoorequal","_this","_classCallCheck","_cbRefresh","_refresh","on","$el","document","createElement","classList","add","key","value","remove","off","_this2","innerHTML","levels","forEach","level","button","strong","textContent","appendChild","addEventListener","setLevel","commonPoi","type","layout","paint","rank2Class","layers","id","filter","base","stops","_objectSpread","concat","minzoom","createImage","image","_ref","channels","data","width","height","Uint8ClampedArray","Uint8Array","buffer","copyImage","srcImg","dstImg","srcPt","dstPt","size","x","y","srcData","dstData","srcOffset","dstOffset","RGBAImage","_ref2","newImage","Math","min","resizeImage","copy","set","_loadSprite","baseUrl","json","format","window","devicePixelRatio","jsonRequest","fetch","then","r","imageRequest","blob","Image","src","URL","createObjectURL","Promise","resolve","reject","onload","onerror","all","imageData","img","padding","canvas","context","getContext","drawImage","getImageData","_json$id","sdf","pixelRatio","stretchX","stretchY","content","GeoJSONSource","map","arguments","opts","defaultOpts","geojson","baseSourceId","sourceId","Object","keys","layerName","addSource","sourceLayers","layer","includes","addLayer","source","_this3","removeLayer","removeSource","VectorTileSource","url","apiKey","queryParams","_this4","_this5","IndoorEqual","_this6","SourceKlass","heatmap","events","isStyleLoaded","_init","setHeatmapVisible","once","fromRemoveEvent","_updateLevelsDebounce","_control","onRemove","name","fn","push","cb","destroy","_updateFilters","_emitLevelChange","console","log","_this7","update","loadSprite","sprite","_sprite$id","_objectWithoutProperties","_excluded","hasImage","updateImage","addImage","visible","getLayer","setLayoutProperty","_this8","addLayers","_updateLevels","bind","_this9","setFilter","_toConsumableArray","isSourceLoaded","features","feature","properties","sort","a","b","reverse","findAllLevels","querySourceFeatures","sourceLayer","arrayEqual","_emitLevelsChange","_refreshAfterLevelsUpdate","_emitEvent","eventName","_len","args","Array","_key"],"mappings":"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","x_google_ignoreList":[0,1]}